{% extends 'base.html' %}

{% block title %}Media Gallery - SPARK{% endblock %}

{% block styles %}
{# Theme CSS loaded by theme-loader.js #}
{% endblock %}

{% block page_title %}Media Gallery{% endblock %}

{% block back_url %}/{% endblock %}

{% block tabs %}
<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab" aria-controls="all" aria-selected="true">ALL images</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="bot-tab" data-bs-toggle="tab" data-bs-target="#bot" type="button" role="tab" aria-controls="bot" aria-selected="false">Bot</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="user-tab" data-bs-toggle="tab" data-bs-target="#user" type="button" role="tab" aria-controls="user" aria-selected="false">User</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="pdf-tab" data-bs-toggle="tab" data-bs-target="#pdf" type="button" role="tab" aria-controls="pdf" aria-selected="false">PDFs</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="mp3-tab" data-bs-toggle="tab" data-bs-target="#mp3" type="button" role="tab" aria-controls="mp3" aria-selected="false">MP3s</button>
    </li>
</ul>
{% endblock %}

{% block content %}
<div class="tab-content" id="myTabContent">

    <!-- Image containers -->
    <div class="tab-pane fade show active" id="all" role="tabpanel">
        <div id="allImages" class="image-grid"></div>
        <button id="deleteSelectedAll" class="btn btn-danger mb-3">Delete Selected</button>
        <nav aria-label="Page navigation">
            <ul class="pagination" id="pagination-all"></ul>
        </nav>
    </div>

    <!-- Bot Images Tab -->
    <div class="tab-pane fade" id="bot" role="tabpanel">
        <div id="botImages" class="image-grid"></div>
        <button id="deleteSelectedBot" class="btn btn-danger mb-3">Delete Selected</button>
        <nav aria-label="Page navigation">
            <ul class="pagination" id="pagination-bot"></ul>
        </nav>
    </div>

    <!-- User Images Tab -->
    <div class="tab-pane fade" id="user" role="tabpanel">
        <div id="userImages" class="image-grid"></div>
        <button id="deleteSelectedUser" class="btn btn-danger mb-3">Delete Selected</button>
        <nav aria-label="Page navigation">
            <ul class="pagination" id="pagination-user"></ul>
        </nav>
    </div>

    <!-- PDF container -->
    <div class="tab-pane fade" id="pdf" role="tabpanel" aria-labelledby="pdf-tab">
        <div id="pdfContainer" class="pdf-grid">

        </div>
        <button id="deleteSelectedPdfs" class="btn btn-danger my-3">Delete Selected</button>
        <nav aria-label="Page navigation">
            <ul class="pagination" id="pagination-pdfs"></ul>
        </nav>
    </div>

    <!-- MP3 container -->
    <div class="tab-pane fade" id="mp3" role="tabpanel" aria-labelledby="mp3-tab">
        <div id="mp3Container" class="mp3-grid">

        </div>
        <button id="deleteSelectedMp3s" class="btn btn-danger my-3">Delete Selected</button>
        <nav aria-label="Page navigation">
            <ul class="pagination" id="pagination-mp3s"></ul>
        </nav>
    </div>

</div>

{% endblock %}

{% block scripts_inline %}
<script>
    const ITEMS_PER_PAGE = 10;
    const images = {{ images|tojson|safe }};
    window.pdfToken = "{{ pdf_token }}";
    window.mp3Token = "{{ mp3_token }}";
    window.cdnFilesUrl = "{{ cdn_files_url }}";
</script>
<script src="{{ get_static_url('/static/js/fullsize-viewer.js') }}"></script>
<script src="{{ get_static_url('/static/js/media_gallery/gallery.js') }}"></script>
<script src="{{ get_static_url('/static/js/media_gallery/pdf.js') }}"></script>
<script src="{{ get_static_url('/static/js/media_gallery/audio.js') }}"></script>
<script>
    const paginationUtils = {
    getCurrentPageData(items, currentPage, itemsPerPage) {
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        return items.slice(startIndex, endIndex);
    },

    createPaginationControls(totalItems, currentPage, itemsPerPage, updateFn) {
        const totalPages = Math.ceil(totalItems / itemsPerPage);
        let paginationHTML = '';

        // Previous button
        paginationHTML += `
            <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>
            </li>
        `;

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                paginationHTML += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" data-page="${i}">${i}</a>
                    </li>
                `;
            } else if (i === currentPage - 3 || i === currentPage + 3) {
                paginationHTML += `
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                `;
            }
        }

        // Next button
        paginationHTML += `
            <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>
            </li>
        `;

        return paginationHTML;
    }
};
</script>
{% endblock %}
